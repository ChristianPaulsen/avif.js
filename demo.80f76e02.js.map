{"version":3,"sources":["../avif.js","index.js","../node_modules/parcel-bundler/src/builtins/bundle-url.js","../node_modules/parcel-bundler/src/builtins/bundle-loader.js","../node_modules/parcel-bundler/src/builtins/loaders/browser/js-loader.js","../node_modules/parcel-plugin-disable-loaders/url-loader.js"],"names":["isEdge","navigator","userAgent","indexOf","decodeMov","arr","blob","Blob","type","blobURL","URL","createObjectURL","Promise","resolve","reject","vid","document","createElement","addEventListener","mozDecodedFrames","webkitDecodedFrameCount","Error","muted","src","play","then","c","ctx","getContext","width","videoWidth","height","videoHeight","drawImage","imgData","getImageData","data","buffer","res","revokeObjectURL","err","handleMessage","e","msg","decoded","serviceWorker","controller","postMessage","id","message","hasAv1Support","canPlayType","getServiceWorkerOpts","forcePolyfill","wasmURL","usePolyfill","register","regPromise","opts","confirmUpdate","Object","assign","onUpdate","window","location","reload","regOpts","scope","undefined","reg","refreshing","refresh","promptUserToRefresh","shouldUpdate","waiting","swOpts","awaitStateChange","waitFor","installing","state","showExternalURL","body","innerHTML","img","appendChild","fetch","extURL","arrayBuffer","avifArr","setupInteractiveDemo","loadButton","getElementById","customItem","fileInput","click","disabled","clearItems","items","querySelectorAll","item","remove","emptyCustomItem","classList","add","firstChild","sendDecodeRequest","file","reader","FileReader","onload","target","result","readAsArrayBuffer","files","value","showCustomImage","bmpArr","className","require","urlParams","URLSearchParams","search","get","bundleURL","getBundleURLCached","getBundleURL","matches","stack","match","getBaseURL","url","replace","exports","loadBundlesLazy","bundles","Array","isArray","length","code","LazyPromise","loadBundles","slice","all","map","loadBundle","bundleLoaders","registerBundleLoader","loader","module","load","bundle","substring","lastIndexOf","toLowerCase","bundleLoader","resolved","catch","executor","promise","prototype","onSuccess","onError","script","async","charset","onerror","getElementsByTagName"],"mappings":"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","file":"demo.80f76e02.js","sourceRoot":"../../home/kagami/code/avif.js/demo","sourcesContent":["// Decode AVIF data using native browser's AV1 decoder.\nconst isEdge = navigator.userAgent.indexOf(\"Edge\") >= 0;\nfunction decodeMov(arr) {\n  const blob = new Blob([arr], {type: \"video/mp4\"});\n  const blobURL = URL.createObjectURL(blob);\n  return new Promise((resolve, reject) => {\n    const vid = document.createElement(\"video\");\n    vid.addEventListener(isEdge ? \"ended\" : \"loadeddata\", () => {\n      if ((vid.mozDecodedFrames == null ||\n           vid.mozDecodedFrames > 0)\n          &&\n          (vid.webkitDecodedFrameCount == null ||\n           vid.webkitDecodedFrameCount > 0)) {\n        resolve(vid);\n      } else {\n        reject(new Error(\"partial AV1 frame\"));\n      }\n    });\n    vid.addEventListener(\"error\", () => {\n      reject(new Error(\"cannot decode AV1 frame\"));\n    });\n    vid.muted = true;\n    vid.src = blobURL;\n    vid.play();\n  }).then(vid => {\n    const c = document.createElement(\"canvas\");\n    const ctx = c.getContext(\"2d\");\n    c.width = vid.videoWidth;\n    c.height = vid.videoHeight;\n    ctx.drawImage(vid, 0, 0, c.width, c.height);\n    const imgData = ctx.getImageData(0, 0, c.width, c.height);\n    return {\n      width: c.width,\n      height: c.height,\n      data: imgData.data.buffer,\n    }\n  }).then(res => {\n    URL.revokeObjectURL(blobURL);\n    return res;\n  }, err => {\n    URL.revokeObjectURL(blobURL);\n    throw err;\n  });\n}\n\n// Respond to job requests from worker.\nfunction handleMessage(e) {\n  const msg = e.data;\n  if (msg && msg.type === \"avif-mov\") {\n    decodeMov(msg.data).then(decoded => {\n      navigator.serviceWorker.controller.postMessage({\n        id: msg.id,\n        type: \"avif-rgba\",\n        ...decoded\n      }, [decoded.data]);\n    }, err => {\n      navigator.serviceWorker.controller.postMessage({\n        id: msg.id,\n        type: \"avif-error\",\n        data: err.message,\n      });\n    });\n  }\n}\n\nfunction hasAv1Support() {\n  const vid = document.createElement(\"video\");\n  return vid.canPlayType('video/mp4; codecs=\"av01.0.05M.08\"') === \"probably\";\n}\n\nfunction getServiceWorkerOpts({forcePolyfill, wasmURL}) {\n  const usePolyfill = forcePolyfill || !hasAv1Support();\n  return {usePolyfill, wasmURL};\n}\n\n// See https://redfin.engineering/how-to-fix-the-refresh-button-when-using-service-workers-a8e27af6df68\n// for the Service Worker update best practices.\nexport function register(regPromise, opts) {\n  if (!(\"serviceWorker\" in navigator)) {\n    return Promise.reject(new Error(\"Service Worker API is not supported\"));\n  }\n\n  if (typeof opts === \"function\") {\n    opts = {confirmUpdate: opts};\n  }\n  opts = Object.assign({\n    confirmUpdate: () => true,\n    onUpdate: () => window.location.reload(),\n    wasmURL: \"/staic/js/dav1d.wasm\",\n    forcePolyfill: false,\n  }, opts);\n\n  if (typeof regPromise === \"string\") {\n    const regOpts = opts.scope ? {scope: opts.scope} : undefined;\n    regPromise = navigator.serviceWorker.register(regPromise, regOpts);\n  }\n  return regPromise.then(reg => {\n    let refreshing = false;\n    function refresh() {\n      if (refreshing) return;\n      refreshing = true;\n      opts.onUpdate(reg);\n    }\n    function promptUserToRefresh() {\n      Promise.resolve(opts.confirmUpdate(reg)).then(shouldUpdate => {\n        if (shouldUpdate) {\n          if (navigator.serviceWorker.controller) {\n            reg.waiting.postMessage({type: \"avif-update\"});\n          } else {\n            refresh();\n          }\n        }\n      });\n    }\n    function awaitStateChange() {\n      const waitFor = navigator.serviceWorker.controller ? \"installed\" : \"activated\";\n      reg.installing.addEventListener(\"statechange\", function() {\n        if (this.state === waitFor) promptUserToRefresh();\n      });\n    }\n\n    navigator.serviceWorker.addEventListener(\"controllerchange\", refresh);\n    navigator.serviceWorker.addEventListener(\"message\", handleMessage);\n    if (navigator.serviceWorker.controller) {\n      const swOpts = getServiceWorkerOpts(opts);\n      navigator.serviceWorker.controller.postMessage({type: \"avif-ready\", data: swOpts});\n    }\n\n    if (reg.waiting) return promptUserToRefresh();\n    reg.addEventListener(\"updatefound\", awaitStateChange);\n  });\n}\n\nexport default {register};\n","import avif from \"../avif.js\";\n\nif (\"serviceWorker\" in navigator) {\n  avif.register(navigator.serviceWorker.register(\"../avif-sw.js\"), {\n    wasmURL: require(\"dav1d.js/dav1d.wasm\"),\n    // forcePolyfill: true,\n  });\n}\n\nfunction showExternalURL() {\n  document.body.innerHTML = \"\";\n  navigator.serviceWorker.addEventListener(\"message\", e => {\n    const msg = e.data;\n    if (msg && msg.type === \"avif-task\") {\n      const blob = new Blob([msg.data], {type: \"image/bmp\"});\n      const img = document.createElement(\"img\");\n      img.src = URL.createObjectURL(blob);\n      document.body.appendChild(img);\n    }\n  });\n  fetch(extURL).then(res => res.arrayBuffer()).then(avifArr => {\n    navigator.serviceWorker.controller.postMessage({\n      id: \"demo\",\n      type: \"avif-task\",\n      data: avifArr,\n    }, [avifArr]);\n  });\n}\n\nfunction setupInteractiveDemo() {\n  const loadButton = document.getElementById(\"load-button\");\n  const customItem = document.getElementById(\"custom-item\");\n  const fileInput = document.getElementById(\"file-input\");\n\n  function clearItems() {\n    const items = document.querySelectorAll(\".item:not(.user)\");\n    for (const item of items) {\n      item.remove();\n    }\n  }\n\n  function emptyCustomItem() {\n    customItem.classList.add(\"hidden\");\n    while (customItem.firstChild) {\n      customItem.firstChild.remove();\n    }\n  }\n\n  // TODO(Kagami): Add this to library API.\n  function sendDecodeRequest(file) {\n    const reader = new FileReader();\n    reader.onload = e => {\n      const avifArr = e.target.result;\n      navigator.serviceWorker.controller.postMessage({\n        id: \"demo\",  // We have only single concurrent task so doesn't matter\n        type: \"avif-task\",\n        data: avifArr,\n      }, [avifArr]);\n    };\n    reader.readAsArrayBuffer(file);\n  }\n\n  function showCustomImage(bmpArr) {\n    const img = document.createElement(\"img\");\n    const blob = new Blob([bmpArr], {type: \"image/bmp\"});\n    img.className = \"user-img\";\n    img.src = URL.createObjectURL(blob);\n    customItem.appendChild(img);\n    customItem.classList.remove(\"hidden\");\n    loadButton.disabled = false;\n  }\n\n  loadButton.addEventListener(\"click\", () => {\n    fileInput.click();\n  });\n\n  fileInput.addEventListener(\"change\", () => {\n    loadButton.disabled = true;\n    clearItems();\n    emptyCustomItem();\n    sendDecodeRequest(fileInput.files[0]);\n    fileInput.value = null;  // Allow to select same value second time\n  });\n\n  navigator.serviceWorker.addEventListener(\"message\", e => {\n    const msg = e.data;\n    if (msg && msg.type === \"avif-task\") {\n      showCustomImage(msg.data);\n    }\n  });\n}\n\nconst urlParams = new URLSearchParams(location.search);\nconst extURL = urlParams.get(\"src\");\ndocument.addEventListener(\"DOMContentLoaded\", extURL ? showExternalURL : setupInteractiveDemo);\n","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var getBundleURL = require('./bundle-url').getBundleURL;\n\nfunction loadBundlesLazy(bundles) {\n  if (!Array.isArray(bundles)) {\n    bundles = [bundles]\n  }\n\n  var id = bundles[bundles.length - 1];\n\n  try {\n    return Promise.resolve(require(id));\n  } catch (err) {\n    if (err.code === 'MODULE_NOT_FOUND') {\n      return new LazyPromise(function (resolve, reject) {\n        loadBundles(bundles.slice(0, -1))\n          .then(function () {\n            return require(id);\n          })\n          .then(resolve, reject);\n      });\n    }\n\n    throw err;\n  }\n}\n\nfunction loadBundles(bundles) {\n  return Promise.all(bundles.map(loadBundle));\n}\n\nvar bundleLoaders = {};\nfunction registerBundleLoader(type, loader) {\n  bundleLoaders[type] = loader;\n}\n\nmodule.exports = exports = loadBundlesLazy;\nexports.load = loadBundles;\nexports.register = registerBundleLoader;\n\nvar bundles = {};\nfunction loadBundle(bundle) {\n  var id;\n  if (Array.isArray(bundle)) {\n    id = bundle[1];\n    bundle = bundle[0];\n  }\n\n  if (bundles[bundle]) {\n    return bundles[bundle];\n  }\n\n  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();\n  var bundleLoader = bundleLoaders[type];\n  if (bundleLoader) {\n    return bundles[bundle] = bundleLoader(getBundleURL() + bundle)\n      .then(function (resolved) {\n        if (resolved) {\n          module.bundle.register(id, resolved);\n        }\n\n        return resolved;\n      }).catch(function(e) {\n        delete bundles[bundle];\n        \n        throw e;\n      });\n  }\n}\n\nfunction LazyPromise(executor) {\n  this.executor = executor;\n  this.promise = null;\n}\n\nLazyPromise.prototype.then = function (onSuccess, onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.then(onSuccess, onError)\n};\n\nLazyPromise.prototype.catch = function (onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.catch(onError)\n};\n","module.exports = function loadJSBundle(bundle) {\n  return new Promise(function (resolve, reject) {\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'text/javascript';\n    script.charset = 'utf-8';\n    script.src = bundle;\n    script.onerror = function (e) {\n      script.onerror = script.onload = null;\n      reject(e);\n    };\n\n    script.onload = function () {\n      script.onerror = script.onload = null;\n      resolve();\n    };\n\n    document.getElementsByTagName('head')[0].appendChild(script);\n  });\n};\n","module.exports = function loadURLBundle(bundle) {\n  return Promise.resolve(bundle);\n};\n"]}